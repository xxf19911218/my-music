<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3 播放器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: contain;
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e7ff; /* Indigo-100 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #6366f1; /* Indigo-500 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4f46e5; /* Indigo-600 */
        }
        .song-item.active {
            background-color: #e0f2fe; /* Sky-100 */
            color: #0369a1; /* Sky-700 */
            font-weight: 500;
        }
        .loader {
            border: 4px solid #e0f2fe; /* Sky-100 */
            border-top: 4px solid #0ea5e9; /* Sky-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Ensure album art image fills its container without distortion */
        #albumArt {
            object-fit: cover; /* Cover the area, cropping if necessary */
            width: 100%;
            height: 100%;
        }
        /* Style for the album art container when showing default icon */
        #albumArtDefaultContainer {
            background-color: #e0e7ff; /* Light indigo background for default */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-sky-200 to-indigo-300 text-slate-800 flex flex-col items-center justify-center min-h-screen p-4 selection:bg-sky-500 selection:text-white">

    <div class="bg-white/70 backdrop-blur-lg shadow-2xl rounded-2xl w-full max-w-sm overflow-hidden">
        <audio id="audioPlayer" class="hidden"></audio>

        <div class="p-6 space-y-4">
            <div class="aspect-square rounded-lg shadow-lg overflow-hidden">
                <div id="albumArtDefaultContainer" class="w-full h-full flex items-center justify-center bg-slate-200">
                    <i class="fas fa-music text-slate-400 text-6xl"></i>
                </div>
                <img id="albumArt" src="" alt="专辑封面" class="w-full h-full object-cover hidden">
            </div>
            <div>
                <h2 id="songTitle" class="text-2xl font-semibold text-center truncate text-slate-700" title="歌曲名称">歌曲名称</h2>
                </div>
        </div>

        <div class="px-6 space-y-2">
            <input type="range" id="progressBar" value="0" class="w-full h-2 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-sky-500">
            <div class="flex justify-between text-xs text-slate-500">
                <span id="currentTime">0:00</span>
                <span id="totalDuration">0:00</span>
            </div>
        </div>

        <div class="flex items-center justify-around p-6">
            <button id="prevBtn" class="text-slate-500 hover:text-sky-500 transition-colors p-3 rounded-full hover:bg-sky-100/50">
                <i class="fas fa-backward-step fa-lg"></i>
            </button>
            <button id="playPauseBtn" class="text-white bg-sky-500 hover:bg-sky-600 transition-colors w-16 h-16 rounded-full flex items-center justify-center shadow-lg">
                <i class="fas fa-play fa-xl"></i>
            </button>
            <button id="nextBtn" class="text-slate-500 hover:text-sky-500 transition-colors p-3 rounded-full hover:bg-sky-100/50">
                <i class="fas fa-forward-step fa-lg"></i>
            </button>
        </div>
        
        <div class="px-6 pb-6 flex items-center space-x-3">
            <i class="fas fa-volume-down text-slate-500"></i>
            <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.5" class="w-full h-2 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-sky-500">
            <i class="fas fa-volume-up text-slate-500"></i>
        </div>

        <div class="border-t border-slate-300/70 p-3">
            <h3 class="text-sm font-medium text-center text-sky-600">播放列表</h3>
        </div>
        
        <div id="playlistContainer" class="h-40 overflow-y-auto bg-white/30">
            </div>
         <div class="flex justify-center py-3">
            <div id="loadingIndicator" class="loader"></div>
        </div>
    </div>

    <script>
        const audioPlayer = document.getElementById('audioPlayer');
        const albumArtDefaultContainer = document.getElementById('albumArtDefaultContainer');
        const albumArt = document.getElementById('albumArt'); // The img tag
        const songTitle = document.getElementById('songTitle');
        // songArtist element removed
        const progressBar = document.getElementById('progressBar');
        const currentTimeDisplay = document.getElementById('currentTime');
        const totalDurationDisplay = document.getElementById('totalDuration');
        const prevBtn = document.getElementById('prevBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playPauseIcon = playPauseBtn.querySelector('i');
        const nextBtn = document.getElementById('nextBtn');
        const volumeControl = document.getElementById('volumeControl');
        const playlistContainer = document.getElementById('playlistContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // --- 歌曲数据 ---
        // artist property removed.
        // albumArt: Provide a URL for actual art, or empty string / "NO_ART" to use default icon.
        const songs = [
            { title: "一生有你", src: "./music/一生有你-水木年华.mp3", albumArt: "" },
            { title: "下雨天", src: "./music/下雨天-南拳妈妈.mp3", albumArt: "" },
            { title: "世界が終るまでは", src: "./music/世界が終るまでは.mp3", albumArt: "" },
            { title: "光阴的故事", src: "./music/光阴的故事-罗大佑.mp3", albumArt: "" },
            { title: "凤凰花开的路口", src: "./music/凤凰花开的路口-胡夏.mp3", albumArt: "" },
            { title: "原来你也在这里", src: "./music/原来你也在这里-刘若英.mp3", albumArt: "" },
            { title: "和你一样", src: "./music/和你一样-李宇春.mp3", albumArt: "" },
            { title: "夜空中最亮的星", src: "./music/夜空中最亮的星-逃跑计划.mp3", albumArt: "" },
            { title: "往后余生", src: "./music/往后余生-王贰浪.mp3", albumArt: "" },
            { title: "忽然之间", src: "./music/忽然之间-莫文蔚.mp3", albumArt: "" },
            { title: "怎样", src: "./music/怎样-戴佩妮.mp3", albumArt: "" },
            { title: "成都", src: "./music/成都-赵雷.mp3", albumArt: "" },
            { title: "我很快乐", src: "./music/我很快乐-刘惜君.mp3", albumArt: "" },
            { title: "无地自容", src: "./music/无地自容-黑豹乐队.mp3", albumArt: "" },
            { title: "没那么简单", src: "./music/没那么简单-黄小琥.mp3", albumArt: "" },
            { title: "爱 很简单", src: "./music/爱 很简单-陶喆.mp3", albumArt: "" },
            { title: "白天不懂夜的黑", src: "./music/白天不懂夜的黑-那英.mp3", albumArt: "" },
            { title: "百年孤寂", src: "./music/百年孤寂-王菲.mp3", albumArt: "" },
            { title: "直到世界尽头", src: "./music/直到世界尽头.mp3", albumArt: "" },
            { title: "空空如也", src: "./music/空空如也-任然.mp3", albumArt: "" },
            { title: "说散就散", src: "./music/说散就散-袁娅维.mp3", albumArt: "" },
            { title: "起风了", src: "./music/起风了-买辣椒也用券.mp3", albumArt: "" },
            { title: "路过人间", src: "./music/路过人间-郁可唯.mp3", albumArt: "" },
            { title: "遇见", src: "./music/遇见-孙燕姿.mp3", albumArt: "" },
            { title: "遥远的你", src: "./music/遥远的你-不靠谱组合.mp3", albumArt: "" }
        ];

        let currentSongIndex = 0;
        let isPlaying = false;

        function loadSong(songIndex) {
            if (songIndex < 0 || songIndex >= songs.length) return;
            
            loadingIndicator.style.display = 'block';
            const song = songs[songIndex];
            currentSongIndex = songIndex;
            
            songTitle.textContent = song.title;
            songTitle.title = song.title; 

            // Handle Album Art
            if (song.albumArt && song.albumArt.trim() !== "" && song.albumArt !== "NO_ART") {
                albumArt.src = song.albumArt;
                albumArt.classList.remove('hidden');
                albumArtDefaultContainer.classList.add('hidden');
            } else {
                albumArt.src = ""; // Clear src if any
                albumArt.classList.add('hidden');
                albumArtDefaultContainer.classList.remove('hidden');
            }
            
            audioPlayer.src = song.src;
            updatePlaylistHighlight();

            audioPlayer.onloadedmetadata = () => {
                totalDurationDisplay.textContent = formatTime(audioPlayer.duration);
                progressBar.max = audioPlayer.duration;
                loadingIndicator.style.display = 'none'; 
                if (isPlaying) { 
                    playSong();
                }
            };
            audioPlayer.onerror = () => {
                loadingIndicator.style.display = 'none';
                playlistContainer.innerHTML = '<p class="text-red-500 p-4 text-center">错误：无法加载歌曲。</p>';
                console.error("Error loading song: " + song.src);
            }
        }

        function playSong() {
            isPlaying = true;
            audioPlayer.play().catch(error => {
                console.error("播放错误:", error);
                isPlaying = false; 
                playPauseIcon.classList.remove('fa-pause');
                playPauseIcon.classList.add('fa-play');
                const errorMsg = document.createElement('p');
                errorMsg.className = 'text-red-500 p-4 text-center';
                errorMsg.textContent = `播放失败: ${error.message}`;
                // Insert error at the top of the playlist, or a dedicated error area
                const firstChild = playlistContainer.firstChild;
                if (firstChild) {
                    playlistContainer.insertBefore(errorMsg, firstChild);
                } else {
                    playlistContainer.appendChild(errorMsg);
                }
                setTimeout(() => { if(errorMsg.parentNode) errorMsg.remove() }, 5000);
            });
            playPauseIcon.classList.remove('fa-play');
            playPauseIcon.classList.add('fa-pause');
        }

        function pauseSong() {
            isPlaying = false;
            audioPlayer.pause();
            playPauseIcon.classList.remove('fa-pause');
            playPauseIcon.classList.add('fa-play');
        }

        function togglePlayPause() {
            if (isPlaying) {
                pauseSong();
            } else {
                playSong();
            }
        }

        function prevSong() {
            currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
            loadSong(currentSongIndex);
        }

        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            loadSong(currentSongIndex);
        }

        function updateProgress() {
            if (audioPlayer.duration) {
                progressBar.value = audioPlayer.currentTime;
                currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
            }
        }

        function setProgress(e) {
            audioPlayer.currentTime = e.target.value;
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function setVolume(e) {
            audioPlayer.volume = e.target.value;
        }

        function renderPlaylist() {
            playlistContainer.innerHTML = '';
            songs.forEach((song, index) => {
                const div = document.createElement('div');
                div.classList.add('song-item', 'p-3', 'hover:bg-sky-50', 'cursor-pointer', 'border-b', 'border-slate-200/80', 'text-sm', 'transition-colors', 'truncate');
                div.textContent = song.title; // Only title
                div.title = song.title; // Tooltip for truncated titles
                
                div.addEventListener('click', () => {
                    loadSong(index);
                });
                playlistContainer.appendChild(div);
            });
            updatePlaylistHighlight();
        }
        
        function updatePlaylistHighlight() {
            const songItems = playlistContainer.querySelectorAll('.song-item');
            songItems.forEach((item, index) => {
                if (index === currentSongIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        playPauseBtn.addEventListener('click', togglePlayPause);
        prevBtn.addEventListener('click', prevSong);
        nextBtn.addEventListener('click', nextSong);
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', nextSong); 
        progressBar.addEventListener('input', setProgress); 
        volumeControl.addEventListener('input', setVolume);
        
        window.addEventListener('load', () => {
            loadSong(currentSongIndex);
            renderPlaylist();
            audioPlayer.volume = 0.5; 
        });
    </script>
</body>
</html>
